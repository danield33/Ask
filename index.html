<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>A Special Question...</title>
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link type="text/css" href="/css/index.css" rel="stylesheet"/>
</head>
<body>
<div class="floating-hearts" id="floatingHearts"></div>


<div class="image-container">
  <div class="valentine-message" id="valentineMessage">
    <p>Will you be my Valentine?</p>
  </div>
  <div class="image-wrapper" id="imageWrapper">
    <div class="image-half left-half" id="leftHalf">
      <img src="img/noggin.jpeg" alt="Noggin"/>
    </div>
    <div class="image-half right-half" id="rightHalf">
      <img src="img/noggin.jpeg" alt="Noggin"/>
    </div>
  </div>
  <div class="overlay" id="overlay">
    <p id="mainText">Guess the password to crack the noggin open</p>
    <input type="text" id="heartInput" placeholder="Hmmm... something happy"/>
    <p class="hint" id="hintText">Hint: Turo</p>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const SECRET_PASSWORD = ["happydaniel1234", "happydaniel123", "happydaniel123!"];
    console.log("loaded")
    function checkPassword() {
      const input = document.getElementById('heartInput').value.toLowerCase();

      if (SECRET_PASSWORD.includes(input)) {
        const mainText = document.getElementById('mainText');
        const inputField = document.getElementById('heartInput');
        const hintText = document.getElementById('hintText');

        // Each element flies off in a different direction
        mainText.classList.add('fly-left');
        setTimeout(() => inputField.classList.add('fly-up'), 100);
        setTimeout(() => hintText.classList.add('fly-right'), 200);

        // After text flies off, split the image and reveal the message
        setTimeout(() => {
          const leftHalf = document.getElementById('leftHalf');
          const rightHalf = document.getElementById('rightHalf');
          const valentineMessage = document.getElementById('valentineMessage');
          const imageWrapper = document.getElementById('imageWrapper');

          // Create firework/smoke effect
          createFireworkEffect(imageWrapper);

          leftHalf.classList.add('wilt-left');
          rightHalf.classList.add('wilt-right');
          valentineMessage.classList.add('reveal');
        }, 1200);
      } else {
        // error.classList.add('show');
        // document.getElementById('password').value = '';
        // setTimeout(() => {
        //   error.classList.remove('show');
        // }, 2000);
      }
    }

    // Enter key support
    document.getElementById('heartInput').addEventListener('keypress', function (e) {
      if (e.key === 'Enter') {
        checkPassword();
      }
    });


    createFloatingHearts();
  });

  function createFireworkEffect(container) {
    const rect = container.getBoundingClientRect();
    const centerX = rect.width / 2;
    const centerY = rect.height / 2;

    const colors = ['#ff6b9d', '#ffb6c1', '#e75480', '#ffd700', '#ff69b4', '#fff'];
    const particleCount = 40;

    for (let i = 0; i < particleCount; i++) {
      const particle = document.createElement('div');
      particle.className = 'firework-particle';

      // Random angle for explosion direction
      const angle = (Math.PI * 2 * i) / particleCount + (Math.random() - 0.5) * 0.5;
      const velocity = 80 + Math.random() * 120;
      const dx = Math.cos(angle) * velocity;
      const dy = Math.sin(angle) * velocity;

      particle.style.setProperty('--dx', dx + 'px');
      particle.style.setProperty('--dy', dy + 'px');
      particle.style.left = centerX + 'px';
      particle.style.top = centerY + 'px';
      particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
      particle.style.animationDelay = (Math.random() * 0.2) + 's';

      // Vary particle sizes
      const size = 4 + Math.random() * 8;
      particle.style.width = size + 'px';
      particle.style.height = size + 'px';

      container.appendChild(particle);

      setTimeout(() => particle.remove(), 1500);
    }

    // Add smoke/puff particles
    for (let i = 0; i < 15; i++) {
      const smoke = document.createElement('div');
      smoke.className = 'smoke-particle';

      const offsetX = (Math.random() - 0.5) * 60;
      const offsetY = (Math.random() - 0.5) * 60;

      smoke.style.left = (centerX + offsetX) + 'px';
      smoke.style.top = (centerY + offsetY) + 'px';
      smoke.style.animationDelay = (Math.random() * 0.3) + 's';

      const size = 20 + Math.random() * 40;
      smoke.style.width = size + 'px';
      smoke.style.height = size + 'px';

      container.appendChild(smoke);

      setTimeout(() => smoke.remove(), 2000);
    }
  }
</script>
<script>
  const input = document.getElementById("heartInput");
  const container = document.querySelector(".image-container");
  const hearts = ['ðŸ’•', 'ðŸ’–', 'ðŸ’—', 'ðŸ’“', 'ðŸ’'];
  const mirror = document.createElement("div");
  document.body.appendChild(mirror);

  mirror.style.position = "absolute";
  mirror.style.visibility = "hidden";
  mirror.style.whiteSpace = "pre";
  mirror.style.font = getComputedStyle(input).font;
  mirror.style.padding = getComputedStyle(input).padding;
  mirror.style.border = getComputedStyle(input).border;

  input.addEventListener("input", () => {
    const heart = document.createElement("div");
    heart.className = "heart";

    heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
    heart.style.left = Math.random() * 100 + '%';
    heart.style.top = Math.random() * 100 + '%';
    heart.style.animationDelay = Math.random();
    heart.style.fontSize = (15 + Math.random() * 20) + 'px';

    const inputRect = input.getBoundingClientRect();
    const containerRect = container.getBoundingClientRect();
    const caretX = getCaretX();

    heart.style.left =
      caretX - containerRect.left + 100 + "px";
    heart.style.top =
      inputRect.top - containerRect.top + "px";

    container.appendChild(heart);

    setTimeout(() => heart.remove(), 1500);
  });


  function getCaretX() {
    const rect = input.getBoundingClientRect();
    const style = getComputedStyle(input);

    mirror.style.width = rect.width + "px";
    mirror.style.font = style.font;
    mirror.style.padding = style.padding;
    mirror.style.border = style.border;

    mirror.textContent =
      input.value.substring(0, input.selectionStart);

    const span = document.createElement("span");
    span.textContent = "|";
    mirror.appendChild(span);

    document.body.appendChild(mirror);
    const caretOffset = span.offsetLeft;
    mirror.innerHTML = "";

    return rect.left + caretOffset;
  }

</script>

</body>
</html>
