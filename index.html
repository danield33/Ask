<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>A Special Question...</title>
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link type="text/css" href="/css/index.css" rel="stylesheet"/>
</head>
<body>
<!-- Mobile blocker -->
<div class="mobile-blocker" id="mobileBlocker">
  <div class="mobile-blocker-content">
    <div class="mobile-icon">ðŸ’»</div>
    <h2>Please Use a Computer</h2>
    <p>This experience is best enjoyed on a desktop or laptop computer.</p>
    <p class="mobile-hint">Come back when you're at a computer!</p>
  </div>
</div>

<div class="floating-hearts" id="floatingHearts"></div>


<div class="image-container">
  <div class="valentine-message" id="valentineMessage">
    <p>Will you be my Valentine?</p>
    <div class="buttons">
      <button class="btn btn-yes" onclick="sayYes()">Yes!</button>
      <button class="btn btn-no" id="noBtn">No</button>
    </div>
  </div>
  <div class="image-wrapper" id="imageWrapper">
    <div class="image-half left-half" id="leftHalf">
      <img src="img/noggin.jpeg" alt="Noggin"/>
    </div>
    <div class="image-half right-half" id="rightHalf">
      <img src="img/noggin.jpeg" alt="Noggin"/>
    </div>
  </div>
  <div class="overlay" id="overlay">
    <p id="mainText">Guess the password to crack the noggin open</p>
    <input type="text" id="heartInput" placeholder="Hmmm... something happy"/>
    <p class="hint" id="hintText">Hint: Turo</p>
  </div>
</div>

<!-- Success overlay with fireworks -->
<div class="success-overlay" id="successOverlay">
  <canvas id="fireworks"></canvas>
  <div class="success-content" id="successContent">
    <h2>Yay! ðŸ’•</h2>
    <div class="photo-frame">
      <img src="img/kiss.gif" alt="Us" id="couplePhoto">
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    // Mobile device detection
    function isMobileDevice() {
      return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)
        || (window.innerWidth <= 768);
    }

    if (isMobileDevice()) {
      document.getElementById('mobileBlocker').classList.add('show');
      return; // Stop execution of the rest of the script
    }

    const SECRET_PASSWORD = ["happydaniel1234", "happydaniel123", "happydaniel123!"];

    function checkPassword() {
      const input = document.getElementById('heartInput').value.toLowerCase();

      if (SECRET_PASSWORD.includes(input)) {
        const mainText = document.getElementById('mainText');
        const inputField = document.getElementById('heartInput');
        const hintText = document.getElementById('hintText');

        // Each element flies off in a different direction
        mainText.classList.add('fly-left');
        setTimeout(() => inputField.classList.add('fly-up'), 100);
        setTimeout(() => hintText.classList.add('fly-right'), 200);

        // After text flies off, split the image and reveal the message
        setTimeout(() => {
          const leftHalf = document.getElementById('leftHalf');
          const rightHalf = document.getElementById('rightHalf');
          const valentineMessage = document.getElementById('valentineMessage');
          const imageWrapper = document.getElementById('imageWrapper');

          // Create firework/smoke effect
          createFireworkEffect(imageWrapper);
          document.getElementById('overlay').style.display = 'none';
          leftHalf.classList.add('wilt-left');
          rightHalf.classList.add('wilt-right');
          valentineMessage.classList.add('reveal');
          setTimeout(() => {imageWrapper.style.zIndex = '-1';}, 2000);
        }, 1200);
      } else {
        // error.classList.add('show');
        // document.getElementById('password').value = '';
        // setTimeout(() => {
        //   error.classList.remove('show');
        // }, 2000);
      }
    }

    // Enter key support
    document.getElementById('heartInput').addEventListener('keypress', function (e) {
      if (e.key === 'Enter') {
        checkPassword();
      }
    });


    createFloatingHearts();
  });

  function createFireworkEffect(container) {
    const rect = container.getBoundingClientRect();
    const centerX = rect.width / 2;
    const centerY = rect.height / 2;

    const colors = ['#ff6b9d', '#ffb6c1', '#e75480', '#ffd700', '#ff69b4', '#fff'];
    const particleCount = 40;

    for (let i = 0; i < particleCount; i++) {
      const particle = document.createElement('div');
      particle.className = 'firework-particle';

      // Random angle for explosion direction
      const angle = (Math.PI * 2 * i) / particleCount + (Math.random() - 0.5) * 0.5;
      const velocity = 80 + Math.random() * 120;
      const dx = Math.cos(angle) * velocity;
      const dy = Math.sin(angle) * velocity;

      particle.style.setProperty('--dx', dx + 'px');
      particle.style.setProperty('--dy', dy + 'px');
      particle.style.left = centerX + 'px';
      particle.style.top = centerY + 'px';
      particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
      particle.style.animationDelay = (Math.random() * 0.2) + 's';

      // Vary particle sizes
      const size = 4 + Math.random() * 8;
      particle.style.width = size + 'px';
      particle.style.height = size + 'px';

      container.appendChild(particle);

      setTimeout(() => particle.remove(), 1500);
    }

    // Add smoke/puff particles
    for (let i = 0; i < 15; i++) {
      const smoke = document.createElement('div');
      smoke.className = 'smoke-particle';

      const offsetX = (Math.random() - 0.5) * 60;
      const offsetY = (Math.random() - 0.5) * 60;

      smoke.style.left = (centerX + offsetX) + 'px';
      smoke.style.top = (centerY + offsetY) + 'px';
      smoke.style.animationDelay = (Math.random() * 0.3) + 's';

      const size = 20 + Math.random() * 40;
      smoke.style.width = size + 'px';
      smoke.style.height = size + 'px';

      container.appendChild(smoke);

      setTimeout(() => smoke.remove(), 2000);
    }
  }
</script>
<script>
  const input = document.getElementById("heartInput");
  const container = document.querySelector(".image-container");
  const hearts = ['ðŸ’•', 'ðŸ’–', 'ðŸ’—', 'ðŸ’“', 'ðŸ’'];
  const mirror = document.createElement("div");
  document.body.appendChild(mirror);

  mirror.style.position = "absolute";
  mirror.style.visibility = "hidden";
  mirror.style.whiteSpace = "pre";
  mirror.style.font = getComputedStyle(input).font;
  mirror.style.padding = getComputedStyle(input).padding;
  mirror.style.border = getComputedStyle(input).border;

  input.addEventListener("input", () => {
    const heart = document.createElement("div");
    heart.className = "heart";

    heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
    heart.style.left = Math.random() * 100 + '%';
    heart.style.top = Math.random() * 100 + '%';
    heart.style.animationDelay = Math.random();
    heart.style.fontSize = (15 + Math.random() * 20) + 'px';

    const inputRect = input.getBoundingClientRect();
    const containerRect = container.getBoundingClientRect();
    const caretX = getCaretX();

    heart.style.left =
      caretX - containerRect.left + 100 + "px";
    heart.style.top =
      inputRect.top - containerRect.top + "px";

    container.appendChild(heart);

    setTimeout(() => heart.remove(), 1500);
  });


  function getCaretX() {
    const rect = input.getBoundingClientRect();
    const style = getComputedStyle(input);

    mirror.style.width = rect.width + "px";
    mirror.style.font = style.font;
    mirror.style.padding = style.padding;
    mirror.style.border = style.border;

    mirror.textContent =
      input.value.substring(0, input.selectionStart);

    const span = document.createElement("span");
    span.textContent = "|";
    mirror.appendChild(span);

    document.body.appendChild(mirror);
    const caretOffset = span.offsetLeft;
    mirror.innerHTML = "";

    return rect.left + caretOffset;
  }

  function sayYes() {
    console.log("YES");
    const successOverlay = document.getElementById('successOverlay');
    const successContent = document.getElementById('successContent');

    successOverlay.classList.add('show');

    // Start fireworks
    startFireworks();

    // Show success content with delay
    setTimeout(() => {
      successContent.classList.add('show');
    }, 500);

    // Create falling hearts
    createFallingHearts();
  }

  // Fireworks animation
  function startFireworks() {
    const canvas = document.getElementById('fireworks');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const particles = [];
    const rockets = [];
    const colors = ['#ff6b9d', '#e75480', '#ff85a2', '#ffc0cb', '#fff', '#ffd700'];

    class Particle {
      constructor(x, y, color) {
        this.x = x;
        this.y = y;
        this.color = color;
        const angle = Math.random() * Math.PI * 2;
        const speed = Math.random() * 6 + 2;
        this.vx = Math.cos(angle) * speed;
        this.vy = Math.sin(angle) * speed;
        this.life = 1;
        this.decay = Math.random() * 0.02 + 0.01;
        this.size = Math.random() * 3 + 2;
      }

      update() {
        this.x += this.vx;
        this.y += this.vy;
        this.vy += 0.05; // gravity
        this.life -= this.decay;
      }

      draw() {
        ctx.save();
        ctx.globalAlpha = this.life;
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
      }
    }

    class Rocket {
      constructor() {
        this.x = Math.random() * canvas.width;
        this.y = canvas.height;
        this.vy = -(Math.random() * 5 + 8);
        this.targetY = Math.random() * canvas.height * 0.5 + 100;
        this.color = colors[Math.floor(Math.random() * colors.length)];
        this.exploded = false;
      }

      update() {
        if (!this.exploded) {
          this.y += this.vy;
          if (this.y <= this.targetY) {
            this.explode();
          }
        }
      }

      explode() {
        this.exploded = true;
        for (let i = 0; i < 80; i++) {
          particles.push(new Particle(this.x, this.y, this.color));
        }
      }

      draw() {
        if (!this.exploded) {
          ctx.fillStyle = this.color;
          ctx.beginPath();
          ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);
          ctx.fill();
        }
      }
    }

    function launchRocket() {
      rockets.push(new Rocket());
    }

    function animate() {
      ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Update and draw rockets
      for (let i = rockets.length - 1; i >= 0; i--) {
        rockets[i].update();
        rockets[i].draw();
        if (rockets[i].exploded) {
          rockets.splice(i, 1);
        }
      }

      // Update and draw particles
      for (let i = particles.length - 1; i >= 0; i--) {
        particles[i].update();
        particles[i].draw();
        if (particles[i].life <= 0) {
          particles.splice(i, 1);
        }
      }

      requestAnimationFrame(animate);
    }

    // Launch rockets periodically
    launchRocket();
    setInterval(launchRocket, 400);
    animate();
  }

  function createFallingHearts() {
    const hearts = ['ðŸ’•', 'ðŸ’–', 'ðŸ’—', 'ðŸ’“', 'ðŸ’', 'â¤ï¸', 'ðŸ’˜'];

    function createHeart() {
      const heart = document.createElement('div');
      heart.className = 'confetti-heart';
      heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
      heart.style.left = Math.random() * 100 + 'vw';
      heart.style.top = '-30px';
      heart.style.animationDuration = (Math.random() * 3 + 2) + 's';
      document.body.appendChild(heart);

      setTimeout(() => heart.remove(), 5000);
    }

    // Create hearts periodically
    const interval = setInterval(createHeart, 150);
    setTimeout(() => clearInterval(interval), 10000);
  }

  // No button teleport functionality
  const noBtn = document.getElementById('noBtn');
  const noMessages = [
    "Are you sure?",
    "You're making me sad :(",
    "Please reconsider!",
    "Think again...",
    "Wrong answer!",
    "Try again!",
    "Not that one!",
    "Nope, try Yes!",
    "Really? :(",
    "Come on...",
    "Pretty please?",
    "I'll be sad...",
    "Don't do this!",
    "You sure sure?",
    "Last chance!"
  ];
  let noMsgIndex = 0;

  noBtn.addEventListener('mouseenter', teleportNoButton);
  noBtn.addEventListener('touchstart', teleportNoButton);

  function teleportNoButton(e) {
    e.preventDefault();

    // Change the button text
    noBtn.textContent = noMessages[noMsgIndex];
    noMsgIndex = (noMsgIndex + 1) % noMessages.length;

    // Make button position fixed so it can move anywhere
    if (noBtn.style.position !== 'fixed') {
      noBtn.style.position = 'fixed';
      noBtn.style.zIndex = '1000';
    }

    // Get button dimensions
    const btnRect = noBtn.getBoundingClientRect();
    const btnWidth = btnRect.width;
    const btnHeight = btnRect.height;

    // Calculate random position within viewport with padding
    const padding = 20;
    const maxX = window.innerWidth/2 - btnWidth - padding;
    const maxY = window.innerHeight/2 - btnHeight - padding;

    const randomX = (padding + Math.random() * maxX) * (Math.random() - 0.5 < 0 ? -1 : 1);
    const randomY = (padding + Math.random() * maxY) * (Math.random() - 0.5 < 0 ? -1 : 1);

    noBtn.style.left = randomX + 'px';
    noBtn.style.top = randomY + 'px';
  }

</script>

</body>
</html>
